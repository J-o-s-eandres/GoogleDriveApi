# ğŸš€ Google Drive Permissions Manager API

![Flask](https://img.shields.io/badge/Flask-2.3.3-000000?style=for-the-badge&logo=flask)
![Google Drive API](https://img.shields.io/badge/Google%20Drive%20API-4285F4?style=for-the-badge&logo=google-drive&logoColor=white)
![Python](https://img.shields.io/badge/Python-3.8%2B-3776AB?style=for-the-badge&logo=python&logoColor=white)

Una API RESTful construida con Flask para gestionar permisos de archivos en Google Drive de manera programÃ¡tica. Perfecta para automatizar la administraciÃ³n de accesos y permisos en tu Google Drive.

## ğŸ“‹ CaracterÃ­sticas Principales

- âœ… **GestiÃ³n completa de permisos** - Listar, otorgar y eliminar permisos
- âœ… **API RESTful** - Endpoints claros y documentados
- âœ… **AutenticaciÃ³n OAuth 2.0** - Segura y confiable
- âœ… **Estructura modular** - SeparaciÃ³n de responsabilidades
- âœ… **CORS configurado** - Listo para integraciÃ³n frontend
- âœ… **Logging detallado** - Facilita debugging y monitoreo

## ğŸ—ï¸ Arquitectura del Proyecto

```
google-drive-manager/
â”œâ”€â”€ app.py                    # Punto de entrada principal
â”œâ”€â”€ requirements.txt          # Dependencias de Python
â”œâ”€â”€ settings.yaml            # ConfiguraciÃ³n de Google OAuth
â”œâ”€â”€ .env                     # Variables de entorno
â”œâ”€â”€ client_secrets.json      # Credenciales de Google Cloud
â”œâ”€â”€ credentials_module.json  # Tokens de acceso (generado)
â”‚# ğŸš€ Google Drive Permissions Manager API

![Flask](https://img.shields.io/badge/Flask-2.3.3-000000?style=for-the-badge&logo=flask)
![Google Drive API](https://img.shields.io/badge/Google%20Drive%20API-4285F4?style=for-the-badge&logo=google-drive&logoColor=white)
![Python](https://img.shields.io/badge/Python-3.8%2B-3776AB?style=for-the-badge&logo=python&logoColor=white)

Una API RESTful construida con Flask para gestionar permisos de archivos en Google Drive de manera programÃ¡tica. Perfecta para automatizar la administraciÃ³n de accesos y permisos en tu Google Drive.

## ğŸ“‹ CaracterÃ­sticas Principales

- âœ… **GestiÃ³n completa de permisos** - Listar, otorgar y eliminar permisos
- âœ… **API RESTful** - Endpoints claros y documentados
- âœ… **AutenticaciÃ³n OAuth 2.0** - Segura y confiable
- âœ… **Estructura modular** - SeparaciÃ³n de responsabilidades
- âœ… **CORS configurado** - Listo para integraciÃ³n frontend
- âœ… **Logging detallado** - Facilita debugging y monitoreo

## ğŸ—ï¸ Arquitectura del Proyecto

```
google-drive-manager/
â”œâ”€â”€ app.py                    # Punto de entrada principal
â”œâ”€â”€ requirements.txt          # Dependencias de Python
â”œâ”€â”€ settings.yaml            # ConfiguraciÃ³n de Google OAuth
â”œâ”€â”€ .env                     # Variables de entorno
â”œâ”€â”€ client_secrets.json      # Credenciales de Google Cloud
â”œâ”€â”€ credentials_module.json  # Tokens de acceso (generado)
â”‚
â”œâ”€â”€ src/                     # CÃ³digo fuente modular
â”‚   â”œâ”€â”€ routes/             # Blueprints de rutas
â”‚   â”œâ”€â”€ services/           # LÃ³gica de negocio
â”‚   â””â”€â”€ utils/              # Utilidades compartidas
â”‚
â”œâ”€â”€ static/                  # Archivos estÃ¡ticos
â”‚   â””â”€â”€ css/
â”‚
â”œâ”€â”€ templates/               # Templates HTML
â”‚   â””â”€â”€ index.html
â”‚
â””â”€â”€ QuickStart.py           # Script de configuraciÃ³n inicial
```

## ğŸš€ InstalaciÃ³n RÃ¡pida

### Prerrequisitos

- Python 3.8 o superior
- Cuenta de Google con Google Drive habilitado
- Acceso a Google Cloud Console

### Paso 1: Clonar el repositorio

```bash
git clone https://github.com/J-o-s-eandres/GoogleDriveApi.git
cd google-drive-manager
```

### Paso 2: Crear y activar entorno virtual

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### Paso 3: Instalar dependencias

```bash
pip install -r requirements.txt
```

### Paso 4: Configurar Google Cloud Console

1. **Accede a** [Google Cloud Console](https://console.cloud.google.com/)
2. **Crea un nuevo proyecto** o selecciona uno existente
3. **Habilita Google Drive API**:
   - Ve a "APIs y servicios" â†’ "Biblioteca"
   - Busca "Google Drive API"
   - Haz clic en "Habilitar"
4. **Configura pantalla de consentimiento OAuth**:
   - Ve a "APIs y servicios" â†’ "Pantalla de consentimiento OAuth"
   - Selecciona "Externo" â†’ "Crear"
   - Completa la informaciÃ³n requerida
   - Agrega el scope: `https://www.googleapis.com/auth/drive`
   - Agrega usuarios de prueba (opcional para desarrollo)

### Paso 5: Descargar credenciales

1. **Ve a** "APIs y servicios" â†’ "Credenciales"
2. **Haz clic en** "Crear credenciales" â†’ "ID de cliente OAuth"
3. **Selecciona** "AplicaciÃ³n de escritorio"
4. **Haz clic en** "Descargar JSON"
5. **Renombra el archivo** a `client_secrets.json`
6. **Mueve el archivo** a la raÃ­z del proyecto

### Paso 6: Configurar settings.yaml

1. **Abre** `client_secrets.json` en un editor de texto
2. **Busca** `client_id` y `client_secret`
3. **Edita** `settings.yaml` con estos valores:

```yaml
client_config_backend: settings
client_config:
  client_id: TU_CLIENT_ID_AQUI
  client_secret: TU_CLIENT_SECRET_AQUI

save_credentials: True
save_credentials_backend: file
save_credentials_file: credentials_module.json

get_refresh_token: True

oauth_scope:
  - https://www.googleapis.com/auth/drive
  - https://www.googleapis.com/auth/drive.file
```

### Paso 7: Ejecutar configuraciÃ³n inicial

```bash
python QuickStart.py
```

Este script abrirÃ¡ tu navegador para autenticarte con Google. Acepta los permisos solicitados.

### Paso 8: Iniciar la aplicaciÃ³n

```bash
python app.py
```

La API estarÃ¡ disponible en: **http://localhost:5000**

## ğŸ“¡ Endpoints de la API

### ğŸ” MÃ©todos GET

| Endpoint | DescripciÃ³n | ParÃ¡metros |
|----------|-------------|------------|
| `GET /` | PÃ¡gina principal de la API | Ninguno |
| `GET /api/status` | Estado del servicio y credenciales | Ninguno |
| `GET /api/test` | Prueba de funcionamiento de la API | Ninguno |
| `GET /api/permissions/{file_id}` | Listar permisos de un archivo | `file_id` |
| `GET /api/file/{file_id}` | Obtener informaciÃ³n de un archivo | `file_id` |

### â• MÃ©todos POST

| Endpoint | DescripciÃ³n | Body (JSON) |
|----------|-------------|-------------|
| `POST /api/permissions` | Otorgar un nuevo permiso | Ver ejemplo abajo |

**Ejemplo Body:**
```json
{
  "file_id": "1abcDEFgHijKlMnOpQRstUVwxyZ123456789",
  "type": "user",
  "value": "usuario@ejemplo.com",
  "role": "writer"
}
```

### âŒ MÃ©todos DELETE

| Endpoint | DescripciÃ³n | ParÃ¡metros/Body |
|----------|-------------|-----------------|
| `DELETE /api/permissions/{file_id}` | Eliminar permiso por ID o email | Body: `{"permission_id": "xxx"}` o `{"email": "xxx"}` |
| `DELETE /api/permissions/{file_id}/email` | Eliminar permiso por email especÃ­fico | Body: `{"email": "xxx"}` |
| `DELETE /api/permissions/{file_id}/{permission_id}` | Eliminar permiso por ID directo | ParÃ¡metro URL: `permission_id` |

## ğŸ› ï¸ Uso con cURL

### Listar permisos de un archivo
```bash
curl -X GET "http://localhost:5000/api/permissions/1abcDEFgHijKlMnOpQRstUVwxyZ123456789"
```

### Otorgar permiso de escritura
```bash
curl -X POST "http://localhost:5000/api/permissions" \
  -H "Content-Type: application/json" \
  -d '{
    "file_id": "1abcDEFgHijKlMnOpQRstUVwxyZ123456789",
    "type": "user",
    "value": "colaborador@ejemplo.com",
    "role": "writer"
  }'
```

### Eliminar permiso por email
```bash
curl -X DELETE "http://localhost:5000/api/permissions/1abcDEFgHijKlMnOpQRstUVwxyZ123456789/email" \
  -H "Content-Type: application/json" \
  -d '{"email": "colaborador@ejemplo.com"}'
```

## ğŸ”§ ConfiguraciÃ³n Avanzada

### Variables de Entorno
Crea un archivo `.env` en la raÃ­z:

```env
SECRET_KEY=tu_clave_secreta_aqui
FLASK_ENV=development
FLASK_DEBUG=True
```

### Tipos de Permisos Disponibles
- **`type`**: `user`, `group`, `domain`, `anyone`
- **`role`**: `reader`, `writer`, `commenter`, `owner`

### Ejemplo de settings.yaml completo
```yaml
client_config_backend: settings
client_config:
  client_id: TU_CLIENT_ID
  client_secret: TU_CLIENT_SECRET

save_credentials: True
save_credentials_backend: file
save_credentials_file: credentials_module.json

get_refresh_token: True
access_type: offline
approval_prompt: force

oauth_scope:
  - https://www.googleapis.com/auth/drive
  - https://www.googleapis.com/auth/drive.file
  - https://www.googleapis.com/auth/drive.metadata

http_timeout: 300
```

## ğŸ› SoluciÃ³n de Problemas

### Error: "Invalid credentials"
```bash
# Elimina las credenciales y reconecta
rm credentials_module.json
python QuickStart.py
```

### Error: "redirect_uri_mismatch"
1. Ve a Google Cloud Console â†’ Credenciales
2. En "URIs de redireccionamiento autorizados" agrega:
   - `http://localhost:8080/`
   - `http://localhost:5000/`

### Error: "insufficient authentication scopes"
```bash
# Elimina credenciales y ejecuta QuickStart.py
rm credentials_module.json
python QuickStart.py
```

### El servidor no inicia
```bash
# Verifica que el puerto 5000 estÃ© libre
netstat -ano | findstr :5000  # Windows
lsof -i :5000                 # Linux/Mac
```

## ğŸ“Š Ejemplo de Respuestas de la API

### âœ… Ã‰xito al listar permisos
```json
{
  "success": true,
  "file_id": "1abcDEFgHijKlMnOpQRstUVwxyZ123456789",
  "file_title": "Documento Importante.docx",
  "permissions": [
    {
      "id": "permission123",
      "type": "user",
      "role": "owner",
      "email": "propietario@ejemplo.com",
      "name": "Juan PÃ©rez"
    }
  ],
  "count": 1
}
```

### âœ… Ã‰xito al otorgar permiso
```json
{
  "success": true,
  "message": "Permiso otorgado exitosamente",
  "permission_id": "permission456",
  "type": "user",
  "value": "colaborador@ejemplo.com",
  "role": "writer"
}
```

### âŒ Error comÃºn
```json
{
  "error": "Error obteniendo permisos: File not found: 1abcDEF",
  "success": false
}
```

## ğŸ§ª Testing

### Pruebas manuales
```bash
# Verificar estado del servicio
curl http://localhost:5000/api/status

# Probar endpoint de prueba
curl http://localhost:5000/api/test
```

## ğŸ“ˆ Monitoreo

La API incluye endpoints para monitoreo:

- **`/api/status`**: Verifica credenciales y estado
- **Logs en consola**: InformaciÃ³n detallada de cada operaciÃ³n

## ğŸ”’ Seguridad

- **Tokens OAuth 2.0**: AutenticaciÃ³n segura con Google
- **Refresh tokens**: Acceso continuo sin reautenticaciÃ³n
- **CORS configurado**: RestricciÃ³n de orÃ­genes permitidos
- **Variables de entorno**: ConfiguraciÃ³n sensible externalizada

## ğŸ¤ Contribuir

1. Haz fork del proyecto
2. Crea una rama (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## ğŸ“„ Licencia

Distribuido bajo la licencia MIT. Ver `LICENSE` para mÃ¡s informaciÃ³n.

## âœ¨ CrÃ©ditos

- **Desarrollado por** - [Tu Nombre/Equipo]
- **Framework** - Flask
- **API de Google Drive** - PyDrive2
- **Estructura modular** - PatrÃ³n de servicios y blueprints

## ğŸ“ Soporte

Para soporte, abre un issue en el repositorio o contacta a [tu-email@ejemplo.com](mailto:tu-email@ejemplo.com)

---

<div align="center">
  
**Â¿Listo para gestionar tus permisos de Google Drive?** ğŸš€

[![Iniciar con QuickStart.py](https://img.shields.io/badge/Empezar-QuickStart.py-green?style=for-the-badge)]()

*Si encuentras Ãºtil este proyecto, considera darle una â­ en GitHub!*

</div>

## ğŸ”„ Flujo de Trabajo TÃ­pico

```mermaid
graph TD
    A[Clonar proyecto] --> B[Crear entorno virtual]
    B --> C[Instalar dependencias]
    C --> D[Configurar Google Cloud]
    D --> E[Descargar client_secrets.json]
    E --> F[Configurar settings.yaml]
    F --> G[Ejecutar QuickStart.py]
    G --> H[Autenticar con Google]
    H --> I[Ejecutar python app.py]
    I --> J[API lista en localhost:5000]
```

